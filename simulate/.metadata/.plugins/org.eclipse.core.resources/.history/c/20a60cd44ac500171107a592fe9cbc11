package circuit;

import java.util.ArrayList;

//回路の情報を格納するクラス(直列)

public class SeriesCircuit
{
	private Element elem[]; //配置されている素子
	private double RSum;    //抵抗の値の合計
	private double LSum;    //インダクタンスの合計
	private double CinvSum; //キャパシタンスの逆数の合計
	private double voltage; //回路の電圧
	private ArrayList<Double> currentList; //電流の値のList
	private ArrayList<Double> voltList;

	//コンストラクタ
	public SeriesCircuit()
	{
		this.elem = new Element[6];
		for(int i = 0; i < 6; i++)
		{
			elem[i] = new Element(0, ElemType.LINE);
		}
		this.RSum = 0;
		this.LSum = 0;
		this.CinvSum = 0;
		this.voltage = 0;
	}

	//セッター
	public void setVoltage(double E)
	{
		this.voltage = E;
	}
	
	public void setElem(int num, double value, ElemType et)
	{
		this.elem[num] = new Element(value, et);
	}
	
	public void setElem(int num, Element elem)
	{
		this.elem[num] = elem;
	}
	
	//ゲッター
	public ArrayList<Double> getCurrentList()
	{
		return this.currentList;
	}
	
	//素子の値をまとめる
	public void elemSum()
	{
		for(Element elem : elem)
		{
			switch(elem.getEt())
			{
				case RESISTANCE:
					RSum += elem.getValue();
					break;

				case CAPACITANCE:
					CinvSum += 1 / elem.getValue();
					break;

				case INDUCTANCE:
					LSum += elem.getValue();
					break;
					
				default :
			}
		}
	}
	
	public void calcVoltage(int num, int start, double end)
	{
		double dt = 0.01;
		double volt;
		double currentSum = 0;
		int times = (int)((end - start) / dt);
		
		voltList = new ArrayList<Double>();
		calcCurrent(start, end);
		
		voltList.add(0.0);
		
		switch(elem[num].getEt())
		{
		case RESISTANCE:
			for(int i = 1;i < times;i++)
			{
				volt = elem[num].getValue() * currentList.get(i);
				voltList.add(volt);
			}
			break;
			
		case CAPACITANCE:
			for(int i = 1;i < times;i++)
			{
				volt = (currentList.get(i) * dt + currentSum);
				currentSum += (currentList.get(i) * dt);
				voltList.add(volt);
			}
			break;
			
		case INDUCTANCE:
			for(int i = 1;i < times;i++)
			{
				volt = elem[num].getValue() * (currentList.get(i) - currentList.get(i - 1));
				voltList.add(volt);
			}
			break;
			
		default :
		}
	}

	//電流を計算してリストに格納
	public void calcCurrent(double start, double end)
	{
		double dt = 0.01;
		double current = 0;
		double currentSum = 0;
		int times = (int)((end - start) / dt);
		
		currentList = new ArrayList<Double>();
		
		elemSum();
		
		currentList.add(0.0);
		
		for(int j = 0;j < times;j++)
		{
			current = (voltage + LSum * current / dt - currentSum * CinvSum) / (RSum + LSum / dt + dt * CinvSum);
			currentList.add(current);
			currentSum += current * dt;
		}
	}
}
